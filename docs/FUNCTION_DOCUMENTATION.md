# Azure DevOps REST Client - Fonksiyon Dok√ºmantasyonu

## üìã ƒ∞√ßindekiler
- [Genel Bakƒ±≈ü](#genel-bakƒ±≈ü)
- [Sƒ±nƒ±f Yapƒ±sƒ±](#sƒ±nƒ±f-yapƒ±sƒ±)
- [Temel Fonksiyonlar](#temel-fonksiyonlar)
- [Kullanƒ±cƒ± Y√∂netimi](#kullanƒ±cƒ±-y√∂netimi)
- [Takƒ±m Y√∂netimi](#takƒ±m-y√∂netimi)
- [Cache Sistemi](#cache-sistemi)
- [G√ºvenlik ve Kimlik Doƒürulama](#g√ºvenlik-ve-kimlik-doƒürulama)
- [Hata Y√∂netimi](#hata-y√∂netimi)
- [Kullanƒ±m √ñrnekleri](#kullanƒ±m-√∂rnekleri)

---

## üéØ Genel Bakƒ±≈ü

`AzureDevOpsRESTClient` sƒ±nƒ±fƒ±, Azure DevOps REST API'si kullanarak kullanƒ±cƒ± ve takƒ±m y√∂netimi i≈ülemlerini ger√ßekle≈ütiren kapsamlƒ± bir Python client'ƒ±dƒ±r.

### Temel √ñzellikler
- ‚úÖ Azure CLI tabanlƒ± kimlik doƒürulama
- ‚úÖ PAT token desteƒüi (geriye d√∂n√ºk uyumluluk)
- ‚úÖ Akƒ±llƒ± cache sistemi (5 dakika TTL)
- ‚úÖ Toplu i≈ülem desteƒüi
- ‚úÖ Geli≈ümi≈ü hata y√∂netimi
- ‚úÖ √áoklu fallback mekanizmasƒ±

---

## üèóÔ∏è Sƒ±nƒ±f Yapƒ±sƒ±

### AzureDevOpsRESTClient

```python
class AzureDevOpsRESTClient:
    """Azure DevOps REST API Client"""
```

#### Cache Sistemi
- `_teams_cache`: Takƒ±m bilgileri cache'i
- `_org_users_cache`: Organizasyon kullanƒ±cƒ±larƒ± cache'i
- `_project_id_cache`: Proje ID cache'i
- `_cache_ttl`: Cache s√ºresi (300 saniye)

#### Batch ƒ∞≈ülem Sistemi
- `_pending_invitations`: Bekleyen davetler listesi
- `_batch_size`: Toplu i≈ülem boyutu (10 kullanƒ±cƒ±)

---

## üîß Temel Fonksiyonlar

### `__init__(self, organization_url: str, project_name: str, pat_token: str = None)`

**Ama√ß:** Azure DevOps REST API Client'ƒ± ba≈ülatƒ±r

**Parametreler:**
- `organization_url` (str): Azure DevOps organizasyon URL'i
- `project_name` (str): Proje adƒ±
- `pat_token` (str, opsiyonel): Personal Access Token

**√ñzellikler:**
- Azure CLI tabanlƒ± kimlik doƒürulama (√∂nerilen)
- PAT token desteƒüi (geriye d√∂n√ºk uyumluluk)
- Otomatik endpoint yapƒ±landƒ±rmasƒ±
- Cache sistemi ba≈ülatma

**√ñrnek Kullanƒ±m:**
```python
# Azure CLI ile (√∂nerilen)
client = AzureDevOpsRESTClient(
    organization_url="https://dev.azure.com/myorg",
    project_name="MyProject"
)

# PAT token ile
client = AzureDevOpsRESTClient(
    organization_url="https://dev.azure.com/myorg",
    project_name="MyProject",
    pat_token="your-pat-token"
)
```

---

### `test_connection(self) -> bool`

**Ama√ß:** Azure DevOps baƒülantƒ±sƒ±nƒ± test eder

**D√∂nd√ºr√ºr:** 
- `bool`: Baƒülantƒ± ba≈üarƒ±lƒ± ise True, deƒüilse False

**ƒ∞≈ülem Adƒ±mlarƒ±:**
1. Projects API endpoint'ini test eder
2. Belirtilen proje adƒ±nƒ±n varlƒ±ƒüƒ±nƒ± kontrol eder
3. Mevcut projeleri listeler (hata durumunda)

**√ñrnek Kullanƒ±m:**
```python
if client.test_connection():
    print("‚úÖ Baƒülantƒ± ba≈üarƒ±lƒ±")
else:
    print("‚ùå Baƒülantƒ± hatasƒ±")
```

---

## üë• Kullanƒ±cƒ± Y√∂netimi

### `check_user_exists_in_org(self, user_email: str) -> bool`

**Ama√ß:** Kullanƒ±cƒ±nƒ±n organizasyonda olup olmadƒ±ƒüƒ±nƒ± kontrol eder (cache ile optimize edilmi≈ü)

**Parametreler:**
- `user_email` (str): Kontrol edilecek kullanƒ±cƒ±nƒ±n e-posta adresi

**D√∂nd√ºr√ºr:**
- `bool`: Kullanƒ±cƒ± organizasyonda varsa True, yoksa False

**√ñzellikler:**
- ‚ö° Cache sistemi ile hƒ±zlƒ± sorgulama
- üîÑ Otomatik cache yenileme
- üìä Performans optimizasyonu

**√ñrnek Kullanƒ±m:**
```python
if client.check_user_exists_in_org("user@example.com"):
    print("Kullanƒ±cƒ± organizasyonda mevcut")
else:
    print("Kullanƒ±cƒ± organizasyonda bulunamadƒ±")
```

---

### `check_multiple_users_exist(self, user_emails: List[str]) -> Dict[str, bool]`

**Ama√ß:** Birden fazla kullanƒ±cƒ±nƒ±n organizasyonda olup olmadƒ±ƒüƒ±nƒ± toplu kontrol eder

**Parametreler:**
- `user_emails` (List[str]): Kontrol edilecek kullanƒ±cƒ±larƒ±n e-posta listesi

**D√∂nd√ºr√ºr:**
- `Dict[str, bool]`: Her kullanƒ±cƒ± i√ßin varlƒ±k durumu

**Avantajlar:**
- üöÄ Toplu i≈ülem performansƒ±
- üìä Tek API √ßaƒürƒ±sƒ± ile √ßoklu kontrol
- üíæ Cache optimizasyonu

**√ñrnek Kullanƒ±m:**
```python
users = ["user1@example.com", "user2@example.com", "user3@example.com"]
results = client.check_multiple_users_exist(users)

for email, exists in results.items():
    status = "‚úÖ Mevcut" if exists else "‚ùå Yok"
    print(f"{email}: {status}")
```

---

### `invite_user_to_organization(self, user_email: str, license_type: str = "stakeholder", team_name: str = None, role: str = "Member") -> bool`

**Ama√ß:** Kullanƒ±cƒ±yƒ± organizasyona davet eder ve isteƒüe baƒülƒ± olarak doƒürudan takƒ±ma ekler

**Parametreler:**
- `user_email` (str): Davet edilecek kullanƒ±cƒ±nƒ±n e-posta adresi
- `license_type` (str): Lisans tipi ("stakeholder", "basic", "basic+testplans")
- `team_name` (str, opsiyonel): Doƒürudan eklenecek takƒ±m adƒ±
- `role` (str): Takƒ±mdaki rol ("Member", "Admin")

**D√∂nd√ºr√ºr:**
- `bool`: ƒ∞≈ülem ba≈üarƒ±lƒ± ise True, deƒüilse False

**ƒ∞≈ülem Adƒ±mlarƒ±:**
1. Kullanƒ±cƒ±nƒ±n organizasyonda olup olmadƒ±ƒüƒ±nƒ± kontrol eder
2. User Entitlements API ile organizasyona davet eder
3. ƒ∞steƒüe baƒülƒ± olarak belirtilen takƒ±ma ekler
4. Detaylƒ± hata raporlama

**√ñrnek Kullanƒ±m:**
```python
# Sadece organizasyona davet
success = client.invite_user_to_organization(
    user_email="newuser@example.com",
    license_type="basic"
)

# Organizasyona davet + takƒ±ma ekleme
success = client.invite_user_to_organization(
    user_email="newuser@example.com",
    license_type="basic",
    team_name="Development Team",
    role="Member"
)
```

---

### `invite_multiple_users_batch(self, user_emails: List[str], license_type: str = "stakeholder") -> Dict[str, bool]`

**Ama√ß:** Birden fazla kullanƒ±cƒ±yƒ± toplu olarak organizasyona davet eder

**Parametreler:**
- `user_emails` (List[str]): Davet edilecek kullanƒ±cƒ±larƒ±n e-posta listesi
- `license_type` (str): T√ºm kullanƒ±cƒ±lar i√ßin lisans tipi

**D√∂nd√ºr√ºr:**
- `Dict[str, bool]`: Her kullanƒ±cƒ± i√ßin davet sonucu

**Avantajlar:**
- üöÄ Toplu i≈ülem performansƒ±
- üìä Batch processing ile API optimizasyonu
- üîÑ Otomatik retry mekanizmasƒ±

**√ñrnek Kullanƒ±m:**
```python
users = ["user1@example.com", "user2@example.com", "user3@example.com"]
results = client.invite_multiple_users_batch(users, "basic")

for email, success in results.items():
    status = "‚úÖ Ba≈üarƒ±lƒ±" if success else "‚ùå Ba≈üarƒ±sƒ±z"
    print(f"{email}: {status}")
```

---

## üè¢ Takƒ±m Y√∂netimi

### `get_teams(self) -> List[Dict]`

**Ama√ß:** Proje takƒ±mlarƒ±nƒ± listeler (cache ile optimize edilmi≈ü)

**D√∂nd√ºr√ºr:**
- `List[Dict]`: Takƒ±m bilgileri listesi

**Takƒ±m Bilgileri:**
- `id`: Takƒ±m ID'si
- `name`: Takƒ±m adƒ±
- `description`: Takƒ±m a√ßƒ±klamasƒ±
- `url`: Takƒ±m URL'i

**√ñzellikler:**
- ‚ö° Cache sistemi (5 dakika TTL)
- üîÑ Otomatik cache yenileme
- üìä Performans optimizasyonu

**√ñrnek Kullanƒ±m:**
```python
teams = client.get_teams()
for team in teams:
    print(f"Takƒ±m: {team['name']} (ID: {team['id']})")
```

---

### `get_team_members(self, team_id: str) -> List[Dict]`

**Ama√ß:** Belirtilen takƒ±mƒ±n √ºyelerini listeler

**Parametreler:**
- `team_id` (str): Takƒ±m ID'si

**D√∂nd√ºr√ºr:**
- `List[Dict]`: Takƒ±m √ºyeleri listesi

**√úye Bilgileri:**
- `identity`: Kullanƒ±cƒ± kimlik bilgileri
- `isTeamAdmin`: Admin yetkisi durumu

**√ñrnek Kullanƒ±m:**
```python
team_members = client.get_team_members("team-id-123")
for member in team_members:
    name = member['identity']['displayName']
    email = member['identity']['uniqueName']
    is_admin = member.get('isTeamAdmin', False)
    role = "Admin" if is_admin else "Member"
    print(f"{name} ({email}) - {role}")
```

---

### `add_user_to_any_group(self, user_email: str, group_name: str, role: str = 'Member') -> bool`

**Ama√ß:** Kullanƒ±cƒ±yƒ± herhangi bir gruba (takƒ±m veya g√ºvenlik grubu) ekler

**Parametreler:**
- `user_email` (str): Kullanƒ±cƒ± e-posta adresi
- `group_name` (str): Grup adƒ± (takƒ±m veya g√ºvenlik grubu)
- `role` (str): Kullanƒ±cƒ±nƒ±n rol√º (sadece takƒ±mlar i√ßin)

**D√∂nd√ºr√ºr:**
- `bool`: ƒ∞≈ülem ba≈üarƒ±lƒ± ise True, deƒüilse False

**ƒ∞≈ülem Adƒ±mlarƒ±:**
1. Grup tipini tespit eder (takƒ±m/g√ºvenlik grubu)
2. Uygun API endpoint'ini se√ßer
3. Kullanƒ±cƒ±yƒ± gruba ekler
4. Fallback mekanizmasƒ± ile alternatif y√∂ntemleri dener

**Grup Tipleri:**
- `team`: Proje takƒ±mlarƒ±
- `security`: G√ºvenlik gruplarƒ±
- `unknown`: Bilinmeyen gruplar (√∂zel gruplar)

**√ñrnek Kullanƒ±m:**
```python
# Takƒ±ma ekleme
success = client.add_user_to_any_group(
    user_email="user@example.com",
    group_name="Development Team",
    role="Member"
)

# G√ºvenlik grubuna ekleme
success = client.add_user_to_any_group(
    user_email="user@example.com",
    group_name="Contributors"
)
```

---

### `add_user_to_team(self, user_email: str, team_name: str, role: str = 'Member') -> bool`

**Ama√ß:** Kullanƒ±cƒ±yƒ± takƒ±ma ekler (geriye uyumluluk i√ßin)

**Parametreler:**
- `user_email` (str): Kullanƒ±cƒ± e-posta adresi
- `team_name` (str): Takƒ±m adƒ±
- `role` (str): Kullanƒ±cƒ± rol√º

**D√∂nd√ºr√ºr:**
- `bool`: ƒ∞≈ülem ba≈üarƒ±lƒ± ise True, deƒüilse False

**Not:** Bu fonksiyon `add_user_to_any_group` fonksiyonuna y√∂nlendirir.

---

## üîç Cache Sistemi

### `_is_cache_valid(self, cache_time) -> bool`

**Ama√ß:** Cache'in hala ge√ßerli olup olmadƒ±ƒüƒ±nƒ± kontrol eder

**Parametreler:**
- `cache_time`: Cache olu≈üturulma zamanƒ±

**D√∂nd√ºr√ºr:**
- `bool`: Cache ge√ßerli ise True, deƒüilse False

**Cache TTL:** 300 saniye (5 dakika)

---

### `_get_teams_from_cache(self) -> Optional[List[Dict]]`

**Ama√ß:** Cache'den takƒ±mlarƒ± alƒ±r

**D√∂nd√ºr√ºr:**
- `Optional[List[Dict]]`: Cache'deki takƒ±mlar veya None

**Avantajlar:**
- ‚ö° Hƒ±zlƒ± veri eri≈üimi
- üìä API √ßaƒürƒ±sƒ± tasarrufu
- üîÑ Otomatik ge√ßerlilik kontrol√º

---

### `_cache_teams(self, teams: List[Dict])`

**Ama√ß:** Takƒ±mlarƒ± cache'ler

**Parametreler:**
- `teams` (List[Dict]): Cache'lenecek takƒ±m listesi

---

### `_load_all_org_users(self) -> List[Dict]`

**Ama√ß:** T√ºm organizasyon √ºyelerini y√ºkler (cache ile optimize edilmi≈ü)

**D√∂nd√ºr√ºr:**
- `List[Dict]`: Organizasyon √ºyeleri listesi

**√ñzellikler:**
- ‚ö° Cache sistemi
- üîÑ Otomatik sayfalama (pagination)
- üìä Performans optimizasyonu

---

## üîê G√ºvenlik ve Kimlik Doƒürulama

### Kimlik Doƒürulama Y√∂ntemleri

#### 1. Azure CLI (√ñnerilen)
```python
client = AzureDevOpsRESTClient(
    organization_url="https://dev.azure.com/myorg",
    project_name="MyProject"
    # pat_token belirtilmez
)
```

#### 2. PAT Token (Geriye D√∂n√ºk Uyumluluk)
```python
client = AzureDevOpsRESTClient(
    organization_url="https://dev.azure.com/myorg",
    project_name="MyProject",
    pat_token="your-pat-token"
)
```

### G√ºvenlik √ñzellikleri
- üîê Azure CLI tabanlƒ± g√ºvenli kimlik doƒürulama
- üõ°Ô∏è PAT token ≈üifreleme
- üîí HTTPS zorunlu baƒülantƒ±
- üìù Detaylƒ± audit logging

---

## üö® Hata Y√∂netimi

### Hata Tipleri ve √á√∂z√ºmleri

#### 1. API Eri≈üim Hatalarƒ±
- **404 Not Found**: API endpoint'i bulunamadƒ±
- **401 Unauthorized**: Kimlik doƒürulama hatasƒ±
- **403 Forbidden**: Yetki yetersizliƒüi

#### 2. Kullanƒ±cƒ± Hatalarƒ±
- **Kullanƒ±cƒ± organizasyonda yok**: √ñnce organizasyona davet edilmeli
- **Takƒ±m bulunamadƒ±**: Takƒ±m adƒ±nƒ± kontrol edin
- **Yetki yetersizliƒüi**: Admin yetkisi gerekli

#### 3. Fallback Mekanizmasƒ±

Kullanƒ±cƒ± ekleme i≈üleminde 3 a≈üamalƒ± fallback sistemi:

1. **Teams API ile e-posta kullanarak ekleme**
2. **Organizasyonda kullanƒ±cƒ± arama ve ID ile ekleme**
3. **Basit davet sistemi (alternatif endpoint'ler)**

### Hata Mesajlarƒ±

```python
# Detaylƒ± hata raporlama √∂rneƒüi
try:
    success = client.add_user_to_team("user@example.com", "Dev Team")
    if not success:
        print("‚ùå Kullanƒ±cƒ± ekleme ba≈üarƒ±sƒ±z")
except Exception as e:
    print(f"üö® Hata: {str(e)}")
```

---

## üîß Geli≈ümi≈ü √ñzellikler

### `wait_for_pending_invitations(self, max_wait_time: int = 30) -> int`

**Ama√ß:** Bekleyen davetlerin i≈ülenmesini bekler

**Parametreler:**
- `max_wait_time` (int): Maksimum bekleme s√ºresi (saniye)

**D√∂nd√ºr√ºr:**
- `int`: ƒ∞≈ülenen davet sayƒ±sƒ±

**Kullanƒ±m Senaryosu:**
Toplu kullanƒ±cƒ± ekleme i≈ülemlerinde, Azure DevOps'un davetleri i≈ülemesi i√ßin bekleme s√ºresi.

---

### `add_user_to_custom_group(self, user_email: str, group_name: str) -> bool`

**Ama√ß:** √ñzel gruplara kullanƒ±cƒ± ekleme - farklƒ± API yakla≈üƒ±mlarƒ±

**Parametreler:**
- `user_email` (str): Kullanƒ±cƒ± e-posta adresi
- `group_name` (str): √ñzel grup adƒ±

**D√∂nd√ºr√ºr:**
- `bool`: ƒ∞≈ülem ba≈üarƒ±lƒ± ise True

**API Yakla≈üƒ±mlarƒ±:**
1. **Graph API ile grup √ºyeliƒüi**
2. **Security Groups API**
3. **Teams API ile √∂zel takƒ±m**
4. **Group Memberships API**

---

## üìö Kullanƒ±m √ñrnekleri

### Temel Kullanƒ±m

```python
# Client olu≈üturma
client = AzureDevOpsRESTClient(
    organization_url="https://dev.azure.com/myorg",
    project_name="MyProject"
)

# Baƒülantƒ± testi
if not client.test_connection():
    print("‚ùå Baƒülantƒ± hatasƒ±")
    exit(1)

# Takƒ±mlarƒ± listele
teams = client.get_teams()
print(f"üìã {len(teams)} takƒ±m bulundu")

# Kullanƒ±cƒ± kontrol√º
user_email = "newuser@example.com"
if client.check_user_exists_in_org(user_email):
    print(f"‚úÖ {user_email} organizasyonda mevcut")
else:
    print(f"‚ùå {user_email} organizasyonda bulunamadƒ±")
```

### Toplu Kullanƒ±cƒ± ƒ∞≈ülemleri

```python
# Toplu kullanƒ±cƒ± kontrol√º
users = ["user1@example.com", "user2@example.com", "user3@example.com"]
results = client.check_multiple_users_exist(users)

# Mevcut olmayan kullanƒ±cƒ±larƒ± davet et
missing_users = [email for email, exists in results.items() if not exists]
if missing_users:
    invite_results = client.invite_multiple_users_batch(missing_users, "basic")
    
    for email, success in invite_results.items():
        if success:
            print(f"‚úÖ {email} ba≈üarƒ±yla davet edildi")
        else:
            print(f"‚ùå {email} davet edilemedi")

# T√ºm kullanƒ±cƒ±larƒ± takƒ±ma ekle
team_name = "Development Team"
for user_email in users:
    success = client.add_user_to_any_group(user_email, team_name, "Member")
    if success:
        print(f"‚úÖ {user_email} takƒ±ma eklendi")
    else:
        print(f"‚ùå {user_email} takƒ±ma eklenemedi")
```

### Hata Y√∂netimi ile G√ºvenli Kullanƒ±m

```python
def safe_add_user_to_team(client, user_email, team_name, role="Member"):
    """G√ºvenli kullanƒ±cƒ± ekleme fonksiyonu"""
    try:
        # 1. Kullanƒ±cƒ± kontrol√º
        if not client.check_user_exists_in_org(user_email):
            print(f"‚ö†Ô∏è {user_email} organizasyonda yok, davet ediliyor...")
            
            # Organizasyona davet et
            invite_success = client.invite_user_to_organization(
                user_email=user_email,
                license_type="basic"
            )
            
            if not invite_success:
                print(f"‚ùå {user_email} davet edilemedi")
                return False
            
            # Davet i≈üleminin tamamlanmasƒ±nƒ± bekle
            print("‚è≥ Davet i≈ülemi bekleniyor...")
            time.sleep(10)
        
        # 2. Takƒ±ma ekle
        success = client.add_user_to_any_group(user_email, team_name, role)
        
        if success:
            print(f"‚úÖ {user_email} ba≈üarƒ±yla {team_name} takƒ±mƒ±na eklendi")
            return True
        else:
            print(f"‚ùå {user_email} takƒ±ma eklenemedi")
            return False
            
    except Exception as e:
        print(f"üö® Hata: {str(e)}")
        return False

# Kullanƒ±m
client = AzureDevOpsRESTClient(
    organization_url="https://dev.azure.com/myorg",
    project_name="MyProject"
)

safe_add_user_to_team(client, "newuser@example.com", "Development Team", "Member")
```

---

## üéØ En ƒ∞yi Uygulamalar

### 1. Kimlik Doƒürulama
- ‚úÖ Azure CLI kullanƒ±n (√∂nerilen)
- ‚ö†Ô∏è PAT token sadece gerekli durumlarda
- üîê Token'larƒ± g√ºvenli saklayƒ±n

### 2. Performans Optimizasyonu
- ‚úÖ Cache sistemini kullanƒ±n
- ‚úÖ Toplu i≈ülemler i√ßin batch fonksiyonlarƒ±
- ‚ö° Gereksiz API √ßaƒürƒ±larƒ±ndan ka√ßƒ±nƒ±n

### 3. Hata Y√∂netimi
- ‚úÖ Her API √ßaƒürƒ±sƒ±nƒ± try-catch ile sarƒ±n
- ‚úÖ Fallback mekanizmalarƒ±nƒ± kullanƒ±n
- üìù Detaylƒ± logging yapƒ±n

### 4. G√ºvenlik
- üîí HTTPS baƒülantƒ± zorunlu
- üõ°Ô∏è Minimum yetki prensibi
- üìä Audit trail tutun

---

## üîÑ S√ºr√ºm Ge√ßmi≈üi

### v2.0.0 (Mevcut)
- ‚úÖ Azure CLI tabanlƒ± kimlik doƒürulama
- ‚úÖ Geli≈ümi≈ü cache sistemi
- ‚úÖ Toplu i≈ülem desteƒüi
- ‚úÖ √áoklu fallback mekanizmasƒ±

### v1.0.0 (Eski)
- PAT token tabanlƒ± sistem
- Temel API i≈ülemleri
- Sƒ±nƒ±rlƒ± hata y√∂netimi

---

## üìû Destek ve Katkƒ±

### Hata Raporlama
Hata bulduƒüunuzda l√ºtfen ≈üu bilgileri ekleyin:
- Hata mesajƒ±
- Kullanƒ±lan parametreler
- Azure DevOps organizasyon yapƒ±sƒ±
- ƒ∞≈ülem adƒ±mlarƒ±

### Katkƒ± Saƒülama
- Fork yapƒ±n
- Feature branch olu≈üturun
- Test yazƒ±n
- Pull request g√∂nderin

---

*Bu dok√ºmantasyon Azure DevOps REST Client v2.0.0 i√ßin hazƒ±rlanmƒ±≈ütƒ±r.*
*Son g√ºncelleme: 2025-01-30*
